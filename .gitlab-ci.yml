# mg-readfiltering CI Docker setup
image: continuumio/miniconda3:latest

stages:
  - test

before_script:
    - conda env create -f environment.yml
    - source activate mg-preprocess

test_job:
  stage: test
  script:
    - mkdir data/
    - echo -e "@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:3192:2157 1:N:0:GTCCGCATTCTTTCCC\nATAGACCTGGTTGACGAATTCCTTCTCGACCGCGTCGTCGCGCGGGCTGGCATATTCCATCGTCACCTCGACGGCCCAGTTGCCCACCGCGCTCGCCGCGAACAGCACGCGGTAGCGGGTCTCCTCCAGCGCGGTGGTCTGGTAGAGGCGCGTGTAGACGCTGGTCGCGGCGATCTTCATCGGCGTCTCGGCGATGGTCTTGCCGCCGGTGCCTTCCTGCTCGATGAAATCCTCGACCAGCGCGGACGAGATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCG\n+\nDDDDDIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIEHIIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIIIIHIIIIIHEHHIIIIIGIIIHIGHIIEHHIIIIGIIHICCHH?GHIIGIIHIIGIIIIGIIII=EHHIG@><<CDHHII-@GHHIHHGEH@GCEHFCCCHH--66@FH??@EEHCDH:45-6-6EHHE##\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:10303:2156 1:N:0:GTCCGCATTCTTTCCC\nAGCAGGACGGTGGTCATGGAAGTCGAAATCCGCTAAGGAGTGTGTAACAACTCACCTGCCGAATCAACTAGCCCCGAAAATGGATGGCGCTAAAGCGCGCGACCTATACCCGGCCGTCGGGGCAAGTACCAAGCCCCGATGAGTAGGAGGGCGCGGCGGTCGCTGTAAAACCCAGGGCGTGAGCCCGGGCGGAGCGGCCGTCGGTGCAGATCTTGGTGGTAGTAGCAAATATTCAAATGAGAACTTTGAAGGCCCAAGATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTC\n+\nDDDDDIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIHIIIIIDHIIIIIIIIIIHIIHIIGHIIIIIIIIIIIIIHIIIIHHIIIIIHIIIIHIIIIIIIIIIIHHIIIIIIHIHIHIIIIIIIIIIIIIIIIIHHIIIIIGIIIIIIIIIIIIHGHHHHHHHIIIIIEHHHIIIIIHIIIIIHIIGHHHIIIHIIHIIHHIIIHHIIIIHHIIIHHIIIIHIHIIIIGHIGIIIICH43F6\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:11977:2114 1:N:0:GTCCGCATTCTTTCCC\nTCGTAGCAATCAATGGTATCAACGGTGTATTCCATCTCGTACAGATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTGAAAAAAAAAAGTCACGACGGGCGCGGTAACCACCTCCGCCGGGTCCTGTCGTCGCGCGAGGATACGCGCAGAGGCCACCTCCGCCGCGCGCGGAGCCGCCGACACGGCCACGACAGCCGGCTCCAGCGGTTCGCCGCTGCGCGCGGTCGCCAGCCGTGTCCGTTGCTGATGCGACTCCACCGTCCTGTCTGTTCA\n+\n@BDDBHIHIHHHIIGFHHIIIHHIIHHGGHIIIIIIHGFHHG@GHIEEHIIIEHFHHHHHHHIHEFEHHIIIIIIFHIIEDCCGD?FCGHHEFHIIIHHH<<GHEEE?HF?C#############################################################################################################################################################################################\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:11782:2245 1:N:0:GTCCGCATTCTTTCCC\nGATGACGGTTGAGGCCCTGAGTTACGACGCTGTTTATGAAGGACGCCCAGATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTGAAAAAAAAAAAGAAAAAAAGAGTGAAGGAACCGCGTGATTCAGTATGCTACCGAGAGAGAGTGTGAACAAGGTATAGTACATCGCATGTAACGCTTGTATCATACTAGACACTTATTAGCCTGGAATCAACGGCTACTCCTCGAAACGAGATAATCAAGCGCAACGCGCAGCTGTGGAAAGGAGAGCAA\n+\nDDDDDIIIIIIIIIIIIIIIIIIIIIIIGIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIID?HGIIIIIIFIIIIIIIIIHIHIIIIIHHIII###################################################################################################################################################################################" | bzip2 -c > data/I16-1249-01-MT1_GTCCGCAT-TCTTTCCC_L001_R1_001.fastq.bz2
    - echo -e "@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:3192:2157 2:N:0:GTCCGCATTCTTTCCC\nCGTCCGCGCTGGTCGAGGATTTCATCGAGCAGGAAGGCACCGGCGGCAAGACCATCGCCGAGACGCCGATGAAGATCGCCGCGACCAGCGTCTACACGCGCCTCTACCAGACCACCGCGCTGGAGGAGACCCGCTACCGCGTGCTGTTCGCGGCGAGCGCGGTGGGCAACTGGGCCGTCGAGGTGACGATGGAATATGCCAGCCCGCGCGACGACGCGGTCGAGAAGGAATTCGTCAACCAGGTCTATAGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTA\n+\nDDDDDIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIGIIIIIIIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIHIIIIIIIIIIHHIIIIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIGIIIIIIIHIIIIIIIIIIHGHHIIHHHIHHIIHHEHHIIEHHHIICCHIIIIIIIDDHDHHDHIHHI@EHHIHHHHIHHHE-@@HHHGHIIIIIIH?H,@D,6@G@FHHCEHHH@FF@###################\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:10303:2156 2:N:0:GTCCGCATTCTTTCCC\nTGGGCCTTCAAAGTTCTCATTTGAATATTTGCTACTACCACCAAGATCTGCACCGACGGCCGCTCCGCCCGGGCTCACGCCCTGGGTTTTACAGCGACCGCCGCGCCCTCCTACTCATCGGGGCTTGGTACTTGCCCCGACGGCCGGGTATAGGTCGCGCGCTTTAGCGCCATCCATTTTCGGGGCTAGTTGATTCGGCAGGTGAGTTGTTACACACTCCTTAGCGGATTTCGACTTCCATGACCACCGTCCTGCTAGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCCCGGTGG\n+\nDDDDDIIIIHIIIIIIHIIIIIIIIIIIIIIIIIIIHIIIIIIIGIIIIIIIIIIIIIIIIIIHIIIIIIIHHIIIIIIIIIIIIIIIHIIIIIIIIIIIIEHIIIIIIIIIIIIIIIEHIIIIHIIIIHIIIIIIIGIIIIIIIIIIHIGIHHIGIIIIIIIIIHIIHIHIIIIIGHIIIIIHCHHHIIIIEHIHHEHHHHIGGHIIGEHIIIIGHEHHHHIIIIGHHIHHHIHEHHIHIIIIIIIHIHHHHIHHI-@@FHEE?<GHEHDHHHHIIHHHHHC?-@-668@F#########\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:11977:2114 2:N:0:GTCCGCATTCTTTCCC\nGTACGAGATGGAATACACCGTTGATACCATTGATTGCTACGAAGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATTANANNNNANNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNANGCNGAAGGCGCGTTAGGAATCACACAGACTTGCGTAGTGCGCTGCCTGCGAGCGTACCCCTGAGGGAAGGCGA\n+\nDDDDDHIHHHIHHHHIIIIIIIIHIIIIIIHIEHHHIIGII=GHHIIIIIIHHHHHHHHEEFEHIIHHGFGHHHHHIEHFHHHHHHH<<FHDHDHHHCEC@########################################################################################################################################################################################################\n@BIOMICS-HISEQLN:351:HTLW5BCXX:1:1101:11782:2245 2:N:0:GTCCGCATTCTTTCCC\nGGGCGTCCTTCATAAACAGCGTCGTAACTCAGGGCCTCAACCGTCATCAGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATTAAAAAAAAAAAAAAAAACCAAAAGAAAGATAGATTAGGACGTCAGAGGAATAGTTAAATAAAACACCGCCACTAAGAATAAGGAAGACACAAAGAAAGAAACTATGCATGATGTGTATACTAGGTATGAAGACGGAGGATGTCGTGCAGAAGAGCTTGAGCAGTAGATATACGATGATGGTAAGAACGCACAGCG\n+\nDDDDDIIIIIIIIIIIIIIIIHIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIHIIHHHIIIHIIIIHIIIIIIHIIIIIIHHIGHIIIHCHGHIIHHHHIIIIHHH#########################################################################################################################################################################################" | bzip2 -c > data/I16-1249-01-MT1_GTCCGCAT-TCTTTCCC_L001_R2_001.fastq.bz2
    - ls -lAhF data/
    - echo -e ">ScriptSeqV2_1\nAGATCGGAAGAGCACACGTCTGAAC\n>ScriptSeqV2_2\nAGATCGGAAGAGCGTCGTGTAGGGA" > adapters.fa
    - cat adapters.fa
    - python3 gen_conf.py -V
    - python3 get_kaiju_otu.py -V
#    - python3 lineage_lookup.py
    - python3 gen_conf.py -vv data/ samples.yaml
    - cat samples.yaml
    - snakemake --use-conda --configfile samples.yaml -p --cores 1 --resources high_diskio=1 -n
